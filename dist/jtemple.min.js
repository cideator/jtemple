/* jtemple - A template engine */

/*
 * Author: Farhan Wazir
 * Email: farhan.wazir@gmail.com
 * Website: http://github.com/farhanwazir/jtemple
 *
 ************ Objective ***********
 * This piece of code is to achieve small task in few lines.
 *
 *
 ************ Description: ***********
 * I was working on one project where i need javascript based template engine but unfortunately
 * available open source template engines are not fulfilling my need but these are not for widgets
 * or small pieces of html codes. Available engines good for use if you are start with them but not
 * for developed applications.
 *
 *
 ************ LICENSE ***********
 * The MIT License (MIT)
 * Copyright (c) 2016 Farhan Wazir
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the "Software"), to deal in the Software without restriction,
 * including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * The above copyright notice and this permission notice shall be included in all copies or substantial
 * portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
 * LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN
 * NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * */
!function(a,b){function d(d,e){var f=a.extend(!0,a.fn[c].defaults,e);this.target=d;var g="\n",h=!1,i=!1,j="jtemple_output";f.target!==!1&&(this.target=a(f.target));var l=[new RegExp("("+f.syntax.statement.start+"for[\\s]*\\([\\s]*)(.+\\S)([\\s]*\\)[\\s]*"+f.syntax.statement.end+")"),new RegExp("("+f.syntax.statement.start+"if[\\s]*\\([\\s]*)(.+\\S)([\\s]*\\)[\\s]*"+f.syntax.statement.end+")"),new RegExp("("+f.syntax.statement.start+"elseif[\\s]*\\([\\s]*)(.+\\S)([\\s]*\\)[\\s]*"+f.syntax.statement.end+")")],m=new RegExp("("+f.syntax.statement.start+"else[\\s]*"+f.syntax.statement.end+")"),n=[new RegExp("("+f.syntax.statement.start+"endfor[\\s]*"+f.syntax.statement.end+")"),new RegExp("("+f.syntax.statement.start+"endif[\\s]*"+f.syntax.statement.end+")")],o=["for(#{statement}#){ \n","if(#{statement}#){ \n","}else if(#{statement}#){ \n"],p="\n}\n",q="\n}else{\n",r=new RegExp(f.syntax.quote,"g"),s=function(){return lines=a('[data-jtemple="'+f.template+'"]').html().split("\n"),output="var "+j+"='';\n",a.each(lines,function(a,b){output+=u(b,a,lines.length)}),output=t(output),output},t=function(a){var b=new RegExp("\\"+f.syntax.variable.start+"[\\s]*(.+\\S)[\\s]*"+f.syntax.variable.end);return a.match(b)instanceof Array&&(a=a.replace(new RegExp(f.syntax.variable.start,"g"),f.syntax.quote+"+").replace(new RegExp(f.syntax.variable.end,"g"),"+"+f.syntax.quote)),a},u=function(b,c,d){for(var e=a.trim(b).replace(r,"\\"+f.syntax.quote),k=0;k<l.length;k++){var s=b.match(l[k]);if(s instanceof Array){h?(e=f.syntax.quote+";",h=!1):e="",e+=b.replace(l[k],o[k].replace("#{statement}#",s[2].replace("&lt;","<").replace("&gt;",">"))),i=!0;break}}i&&!h&&(e+=g+j+"+="+f.syntax.quote,h=!0);var s=b.match(m);s instanceof Array&&(h?(e=f.syntax.quote+";",h=!1):e="",e+=b.replace(m,q),i=!0,i&&!h&&(e+=g+j+"+="+f.syntax.quote,h=!0));for(var k=0;k<n.length;k++){var s=b.match(n[k]);if(s instanceof Array){h?(e=f.syntax.quote+";",h=!1):e="",e+=b.replace(n[k],p),i=!1;break}}return c==d-1?(h&&(e+=f.syntax.quote+";",h=!1),i&&(e+=p,i=!1)):i||h||(e+=j+"+="+f.syntax.quote,h=!0),e},v=function(c){return this.data=c,a.globalEval(s()),b[j]},w=function(b){switch(f.publish){case"append":a(b).append(v(f.data));break;case"prepend":a(b).prepend(v(f.data));break;default:a(b).html(v(f.data))}};return w(this.target),this}var c="jtemple";a.fn[c]=function(a){return this.each(function(){new d(this,a)})},a.fn[c].defaults={template:"tmpl",data:[],syntax:{quote:'"',variable:{start:"{#",end:"#}"},statement:{start:"#",end:";"}},target:!1,publish:"replace"},a(document).ready(function(){a("[data-jtemple]").css("display","none")})}(jQuery,window);